<!DOCTYPE html>
<html>
<head>
    <title>Quest XR View Test</title>
    <style>
        body { margin: 0; background: black; }
        canvas { width: 100vw; height: 100vh; }
        #status { position: fixed; top: 10px; left: 10px; color: white; }
        #controls { 
            position: fixed; 
            top: 10px; 
            right: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        button {
            padding: 10px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="status">Initializing...</div>
    <div id="controls">
        <button onclick="startXRSession()">Start XR View</button>
        <button onclick="stopXRSession()">Stop XR View</button>
    </div>
    <canvas id="xr-canvas"></canvas>

    <script>
        const statusElement = document.getElementById('status');
        const canvas = document.getElementById('xr-canvas');
        let xrSession = null;
        let xrRefSpace = null;

        async function checkXRSupport() {
            statusElement.textContent = 'Checking XR support...';
            
            if (navigator.xr) {
                try {
                    const supported = await navigator.xr.isSessionSupported('immersive-ar');
                    if (supported) {
                        statusElement.textContent = 'XR Supported! Click Start.';
                    } else {
                        statusElement.textContent = 'AR not supported';
                    }
                } catch (err) {
                    statusElement.textContent = 'Error checking XR support: ' + err;
                }
            } else {
                statusElement.textContent = 'WebXR not available';
            }
        }

        async function startXRSession() {
            try {
                xrSession = await navigator.xr.requestSession('immersive-ar', {
                    optionalFeatures: ['dom-overlay'],
                    domOverlay: { root: document.body }
                });

                const gl = canvas.getContext('webgl', { xrCompatible: true });
                const xrGLLayer = new XRWebGLLayer(xrSession, gl);
                xrSession.updateRenderState({ baseLayer: xrGLLayer });

                xrRefSpace = await xrSession.requestReferenceSpace('local');

                xrSession.requestAnimationFrame(onXRFrame);
                statusElement.textContent = 'XR session started';
            } catch (err) {
                statusElement.textContent = 'Error starting XR session: ' + err;
            }
        }

        function stopXRSession() {
            if (xrSession) {
                xrSession.end();
                statusElement.textContent = 'Session ended';
            }
        }

        function onXRFrame(time, frame) {
            const session = frame.session;
            session.requestAnimationFrame(onXRFrame);

            const pose = frame.getViewerPose(xrRefSpace);
            if (pose) {
                const view = pose.views[0];
                statusElement.textContent = 'Viewing XR content';
            }
        }

        document.addEventListener('DOMContentLoaded', checkXRSupport);
    </script>
</body>
</html>
